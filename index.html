<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>No.</title>

  <meta name="description" content="No." />
  <meta property="og:title" content="No." />
  <meta property="og:description" content="The answer is no." />
  <meta property="og:type" content="website" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Performance polish: load font without blocking render -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&display=swap"
        rel="stylesheet" media="print" onload="this.media='all'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;900&display=swap" rel="stylesheet">
  </noscript>

  <style>
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
    }

    :root {
      color-scheme: light dark;
      --no-top: 38vh;
      --gap: clamp(10px, 2vh, 18px);
      --side-pad: clamp(16px, 4vw, 44px);
      --bg-shift: 0; /* for background shift */
    }

    body {
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      text-align: center;
      padding: var(--side-pad);
      background: #ffffff;
      color: #111111;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;

      /* Fade background shift on click */
      transition: background 350ms ease;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background: radial-gradient(
          circle at calc(50% + (var(--bg-shift) * 1%)) center,
          #1a1a1a,
          #0f0f0f
        );
        color: #ffffff;
      }
    }

    @media (prefers-color-scheme: light) {
      body {
        background: radial-gradient(
          circle at calc(50% + (var(--bg-shift) * 1%)) center,
          #ffffff,
          #f2f2f2
        );
      }
    }

    .no {
      position: fixed;
      left: 50%;
      top: var(--no-top);
      transform: translate(-50%, -50%);
      margin: 0;
      font-weight: 900;
      letter-spacing: -0.04em;
      line-height: 1;
      font-size: clamp(44px, 10vw, 100px);
      white-space: nowrap;
      user-select: none;
      pointer-events: none;
      will-change: transform; /* parallax perf */
    }

    .reason {
      position: fixed;
      left: 50%;
      top: calc(var(--no-top) + var(--gap) + 56px);
      transform: translate(-50%, 10px);
      width: min(920px, calc(100vw - (2 * var(--side-pad))));
      margin: 0;

      font-size: clamp(16px, 3.2vw, 28px);
      line-height: 1.4;
      opacity: 0;
      overflow-wrap: anywhere;

      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 4;
      overflow: hidden;

      transition: opacity 250ms ease, transform 250ms ease;
      pointer-events: none;
    }

    .reason.loaded {
      opacity: 0.9;
      transform: translate(-50%, 0);
    }

    @media (min-height: 820px) {
      .reason { -webkit-line-clamp: 5; }
    }

    .footer {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: 0.55;
      white-space: nowrap;
      pointer-events: none;
    }
  </style>
</head>

<body>
  <h1 class="no" id="noText">No.</h1>
  <p id="reason" class="reason" aria-live="polite">Loading…</p>
  <div class="footer">© <span id="year"></span> Dimuth. Thanks for stopping by!</div>

  <script>
    const API_URL = "https://naas.isalman.dev/no";
    const reasonEl = document.getElementById("reason");
    const noEl = document.getElementById("noText");
    const yearEl = document.getElementById("year");

    const variants = ["No.", "Nope.", "Absolutely not.", "Hard pass.", "That’s a no.", "Not today.", "Respectfully, no."];

    // Instant feel: preload next reason in background
    let nextReason = null;
    let nextFetchedAt = 0;

    function pickVariant() {
      return variants[Math.floor(Math.random() * variants.length)];
    }

    function routePrefix() {
      const path = window.location.pathname || "/";
      if (path === "/" || path === "/index.html") return "";
      return `You tried “${path}”. `;
    }

    function shiftBackground() {
      // Small random shift (-18..18) that only affects the radial gradient center
      const v = Math.floor(Math.random() * 37) - 18;
      document.documentElement.style.setProperty("--bg-shift", String(v));
    }

    async function fetchReason({ timeoutMs = 4000 } = {}) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), timeoutMs);

      try {
        const res = await fetch(API_URL + "?t=" + Date.now(), {
          headers: { "Accept": "application/json" },
          signal: controller.signal
        });
        if (!res.ok) throw new Error("Network error");
        const data = await res.json();
        return data?.reason || null;
      } finally {
        clearTimeout(timeout);
      }
    }

    async function preloadNext() {
      // Avoid overly frequent preloads (basic throttle)
      if (Date.now() - nextFetchedAt < 500) return;

      try {
        const r = await fetchReason({ timeoutMs: 4000 });
        if (r) {
          nextReason = r;
          nextFetchedAt = Date.now();
        }
      } catch {
        // silent (preload failure shouldn't show UI errors)
      }
    }

    let loading = false;

    async function loadReason() {
      if (loading) return;
      loading = true;

      // background shift + new "No."
      shiftBackground();
      noEl.textContent = pickVariant();

      reasonEl.classList.remove("loaded");
      reasonEl.textContent = "Loading…";

      try {
        // Use preloaded reason if available for instant feel
        let reason = nextReason;
        nextReason = null;

        if (!reason) {
          reason = await fetchReason({ timeoutMs: 4000 });
        }

        if (!reason) {
          // Improve failure mode (witty, consistent with theme)
          reasonEl.textContent = routePrefix() + "Even the server said no.";
        } else {
          reasonEl.textContent = routePrefix() + reason;
        }

        // Immediately preload the next one after showing current
        preloadNext();
      } catch {
        reasonEl.textContent = routePrefix() + "Even the server said no.";
        preloadNext();
      } finally {
        requestAnimationFrame(() => reasonEl.classList.add("loaded"));
        loading = false;
      }
    }

    // “No.” reacts to mouse position (subtle). Disable on touch devices.
    const isTouch = window.matchMedia("(pointer: coarse)").matches;
    if (!isTouch) {
      document.addEventListener("mousemove", (e) => {
        const dx = (e.clientX / window.innerWidth - 0.5) * 14; // px
        const dy = (e.clientY / window.innerHeight - 0.5) * 10; // px
        noEl.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
      });
    }

    document.addEventListener("click", loadReason);
    yearEl.textContent = new Date().getFullYear();

    // initial load + start preload pipeline
    loadReason();
    preloadNext();
  </script>
</body>
</html>
